---
resource_types:
- name: terraform
  type: docker-image
  source:
    repository: ljfranklin/terraform-resource
    tag: 1.2.2

resources:
- name: training-infra
  type: git
  icon: github
  source:
    uri: https://github.com/EngineerBetter/training-infra

- name: terraform
  type: terraform
  icon: terraform
  source:
    env_name: ((env))
    backend_type: s3
    backend_config:
      bucket: mybucket
      key: mydir/terraform.tfstate
      region: eu-west-2
      access_key: (())
      secret_key: {{storage_secret_key}}
    vars:
      tag_name: concourse
    env:
      AWS_ACCESS_KEY_ID: {{environment_access_key}}
      AWS_SECRET_ACCESS_KEY: {{environment_secret_key}}

jobs:
- name: hello
  plan:
  - get: training-infra
    trigger: true
  - task: hello
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: { repository: busybox }
      run:
        path: echo
        args: ["Hello, World!"]